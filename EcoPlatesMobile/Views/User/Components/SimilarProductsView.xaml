<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="EcoPlatesMobile.Views.User.Components.SimilarProductsView"
             xmlns:models="clr-namespace:EcoPlatesMobile.Models.User"
             xmlns:language="clr-namespace:EcoPlatesMobile.Resources.Languages"
             xmlns:view="clr-namespace:EcoPlatesMobile.Views.Components"
             BackgroundColor="White">

       <Grid RowDefinitions="1, Auto, 10, Auto"
             Grid.Row="4">
              <BoxView x:Name="boxLineView"
                       BackgroundColor="LightGray"/>
              <Grid x:Name="grdAll"
                    ColumnDefinitions="Auto, *, Auto"
                    Margin="10,0,10,0" 
                    Grid.Row="1">
                     <Label Text="{x:Static language:AppResource.SimilarProducts}"
                            TextColor="Black"
                            FontSize="17"
                            FontAttributes="Bold"
                            FontFamily="RobotoVar"
                            HorizontalOptions="Start"
                            VerticalOptions="Center"/>
                     <Border x:Name="brdAll"
                             WidthRequest="90"
                             HeightRequest="30"
                             VerticalOptions="Center"
                             BackgroundColor="{StaticResource User}"
                             Margin="0,10,0,0"
                             Grid.Column="2">
                            <Border.GestureRecognizers>
                                   <TapGestureRecognizer NumberOfTapsRequired="1"
                                                        Tapped="All_Tapped"/>
                            </Border.GestureRecognizers>
                            <Border.StrokeShape>
                            <RoundRectangle CornerRadius="10" />
                            </Border.StrokeShape>
                            <Grid ColumnDefinitions="*, Auto">
                                   <Label Text="{x:Static language:AppResource.More}"
                                          TextColor ="White"
                                          VerticalOptions="Center"
                                          HorizontalOptions="Center"/>
                                   <Image Source="right_white.png"
                                          WidthRequest="15"
                                          HeightRequest="15"       
                                          VerticalOptions="Center"
                                          Margin="0,0,5,0"
                                          Grid.Column="1"/>
                            </Grid>
                     </Border>
              </Grid>
              <CollectionView x:Name="productList"
                              HeightRequest="230"
                              HorizontalScrollBarVisibility="Never"
                              ItemsSource="{Binding Products}"
                              ItemsUpdatingScrollMode="KeepScrollOffset"
                              SelectionMode="Single"
                              RemainingItemsThreshold="2"
                              RemainingItemsThresholdReached="OnRemainingItemsThresholdReached"
                              Grid.Row="3">
                     <CollectionView.ItemsLayout>
                            <LinearItemsLayout Orientation="Horizontal"
                                                 ItemSpacing="10" />
                     </CollectionView.ItemsLayout>
                     <CollectionView.ItemTemplate>
                            <DataTemplate>
                                   <Frame WidthRequest="165"
                                          HeightRequest="230"
                                          Padding="10"
                                          VerticalOptions="Fill"
                                          CornerRadius="14"
                                          HasShadow="False"
                                          BorderColor="#E5E5E5"
                                          BackgroundColor="White"
                                          Margin="0,0,10,0">
                                          <Frame.GestureRecognizers>
                                                 <TapGestureRecognizer NumberOfTapsRequired="1"
                                                                       Tapped="Product_Tapped"/>
                                          </Frame.GestureRecognizers>
                                          <VerticalStackLayout Spacing="6"
                                                               VerticalOptions="FillAndExpand">

                                                 <!-- Image -->
                                                 <Image Source="{Binding ProductImage}"
                                                        HeightRequest="100"
                                                        Aspect="AspectFill" />

                                                 <!-- Name -->
                                                 <Label Text="{Binding ProductName}"
                                                        FontAttributes="Bold"
                                                        TextColor="Black"
                                                        LineBreakMode="TailTruncation"
                                                        MaxLines="1" />

                                                 <!-- Old price (string already) -->
                                                 <Label Text="{Binding OldPrice}"
                                                        TextDecorations="Strikethrough"
                                                        TextColor="Black"
                                                        Opacity="0.6"
                                                        FontSize="12"
                                                        IsVisible="{Binding OldPriceDigit, Converter={StaticResource NullToBoolConverter}}" />

                                                 <!-- New price -->
                                                 <Label Text="{Binding NewPrice}"
                                                        FontAttributes="Bold"
                                                        TextColor="#007100"
                                                        FontSize="16"/>

                                                 <!-- Stars + count -->
                                                 <view:StarRatingView Rating="{Binding Stars, Converter={StaticResource StringToDoubleConverter}}"
                                                                      Text="{Binding Count}" />
                                         </VerticalStackLayout>
                                   </Frame>       
                            </DataTemplate>
                     </CollectionView.ItemTemplate>        
              </CollectionView>
              <ActivityIndicator x:Name="loadingView"
                                 Color="{StaticResource User}"
                                 Scale="1"
                                 VerticalOptions="Center"
                                 HorizontalOptions="Center"
                                 Grid.Row="3"/>
       </Grid>
</ContentView>
