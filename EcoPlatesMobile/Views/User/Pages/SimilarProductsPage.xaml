<?xml version="1.0" encoding="utf-8" ?>
<page:BasePage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
               xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
               xmlns:page="clr-namespace:EcoPlatesMobile.Views"
               xmlns:language="clr-namespace:EcoPlatesMobile.Resources.Languages"
               xmlns:component="clr-namespace:EcoPlatesMobile.Views.Components"
               xmlns:user_component="clr-namespace:EcoPlatesMobile.Views.User.Components"
               xmlns:local="clr-namespace:EcoPlatesMobile.Views.User.Pages"
               xmlns:view="clr-namespace:EcoPlatesMobile.Views.Components"
               x:Class="EcoPlatesMobile.Views.User.Pages.SimilarProductsPage"
               BackgroundColor="White">

        <Grid RowDefinitions="Auto, *">
            <component:CustomHeader Title="{x:Static language:AppResource.SimilarProducts}"
                                    HeaderBackground="#007100"/>
            <RefreshView IsRefreshing="{Binding IsRefreshing}"
                         Command="{Binding RefreshCommand}"
                         Margin="10,10,10,5"
                         Grid.Row="2">
                <CollectionView x:Name="productList" 
                                ItemsSource="{Binding Products}"
                                ItemsUpdatingScrollMode="KeepScrollOffset"
                                SelectionMode="None"
                                RemainingItemsThreshold="4"
                                RemainingItemsThresholdReachedCommand="{Binding LoadMoreCommand}">
                    <CollectionView.EmptyView>
                        <ContentView>
                            <ContentView.Triggers>
                                <DataTrigger TargetType="ContentView"
                                            Binding="{Binding IsLoading}"
                                            Value="True">
                                    <Setter Property="IsVisible" Value="False" />
                                </DataTrigger>
                                <DataTrigger TargetType="ContentView"
                                            Binding="{Binding IsRefreshing}"
                                            Value="True">
                                    <Setter Property="IsVisible" Value="False" />
                                </DataTrigger>
                            </ContentView.Triggers>
                            <view:EmptyViewText/>
                        </ContentView>
                    </CollectionView.EmptyView>
                    <CollectionView.ItemsLayout>
                        <GridItemsLayout Orientation="Vertical" 
                                        VerticalItemSpacing="10"
                                        HorizontalItemSpacing="10"
                                        Span="2"/>
                    </CollectionView.ItemsLayout>
                    <CollectionView.ItemTemplate>
                        <DataTemplate>
                            <user_component:ProductView ProductImage="{Binding ProductImage}"
                                                        ProductName="{Binding ProductName}"
                                                        ProductMakerName="{Binding ProductMakerName}"
                                                        NewPrice="{Binding NewPrice}"
                                                        OldPrice="{Binding OldPrice}"
                                                        Stars="{Binding Stars}"
                                                        Distance="{Binding Distance}"
                                                        Liked="{Binding Liked}"
                                                        LikeCommand="{Binding Source={RelativeSource AncestorType={x:Type local:SimilarProductsPage}}, Path=BindingContext.LikeProductCommand}"
                                                        ClickCommand="{Binding Source={RelativeSource AncestorType={x:Type local:SimilarProductsPage}}, Path=BindingContext.ClickProductCommand}"/>
                        </DataTemplate>
                    </CollectionView.ItemTemplate>
                </CollectionView>
            </RefreshView>
            <component:CustomLikedView x:Name="likeView" 
                                    ShowLiked="{Binding IsLikedViewLiked}"
                                    IsVisible="{Binding ShowLikedView}"
                                    Grid.Row="1"/>
            <ActivityIndicator IsRunning="{Binding IsLoading}"
                               Color="{StaticResource User}"
                               Scale="1.5"
                               VerticalOptions="Center"
                               HorizontalOptions="Center"
                               Grid.Row="1"/>
        </Grid>
</page:BasePage>